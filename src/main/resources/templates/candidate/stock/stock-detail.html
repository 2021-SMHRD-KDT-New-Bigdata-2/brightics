<!DOCTYPE HTML>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.orh/extra/spring-security">
<head>
    <style>
        input[type="date"]::-webkit-clear-button, input[type="date"]::-webkit-inner-spin-button {
            display: inline-block;
        }
        input[type="date"] {
            background: transparent;
            color: white;
        }
        .dateSend {
            text-align : center;
        }


    </style>
    <div th:replace="/fragments/head :: headFragment"></div>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
        function nullCheck(data){
            if (!data){
                return true;
            }
            else {
                return false;
            }
        }
        var newsChartData
        var newsStart;
        var newsEnd;
        $(document).ready(function () {
            newsChart()
            $("#newsCheck").click(function () {
                newsStart= document.getElementById("newsStart").value;
                newsEnd= document.getElementById("newsEnd").value;

                $("#news_error").text("")
                if(nullCheck(newsStart)||nullCheck(newsEnd) || Date.parse(newsStart)>Date.parse(newsEnd)){
                    $("#news_error").html("<h4><i class=\"fas fa-exclamation-triangle\"></i>Please check the date</h4>")
                    return;
                }

                $("#news_title").text(newsStart+"부터 "+newsEnd+ "까지의 뉴스 수");

                newsChart();
            })

            function newsChart() {
                $.ajax({
                    url: location.pathname+"/getnewsgraph" ,
                    data: {
                        "start": newsStart,
                        "end": newsEnd
                    },
                    type: 'get',
                    success: function (data) {
                        data.unshift(['기간', '빈도'])
                        newsChartData = data
                        google.charts.load('current', {'packages': ['corechart']});
                        google.charts.setOnLoadCallback(drawNewsChart);
                    },
                    error: function (err) {
                    }
                })
            }})
        var stockChartData
        var stockStart;
        var stockEnd;
        $(document).ready(function () {
            stockChart()
            $("#stockCheck").click(function () {
                stockStart= document.getElementById("stockStart").value;
                stockEnd= document.getElementById("stockEnd").value;
                $("#stock_error").text("")
                if(nullCheck(stockStart)||nullCheck(stockEnd) || Date.parse(stockStart)>Date.parse(stockEnd)){
                    $("#stock_error").html("<h4><i class=\"fas fa-exclamation-triangle\"></i>Please check the date</h4>")
                    return;
                }
                $("#stock_title").text(stockStart+"부터 "+stockEnd+ "까지의 주식 차트");
                stockChart()
            })
            function stockChart() {
                $.ajax({
                    url: location.pathname+"/getstockgraph" ,
                    data: {
                        "start": stockStart,
                        "end": stockEnd
                    },
                    type: 'get',
                    success: function (data) {
                        stockChartData = data
                        google.charts.load('current', {'packages':['corechart']});
                        google.charts.setOnLoadCallback(drawStockChart);
                    },
                    error: function (err) {
                    }
                })
            }})
        function drawNewsChart() {
            var data = google.visualization.arrayToDataTable(newsChartData);
            var options = {
                title: "",
                hAxis: {title: '기간', titleTextStyle: {color: '#333'}},
                vAxis: {minValue: 0},
                backgroundColor: "transparent",

                hAxis: {
                    textStyle: {
                        color: 'white'
                    },
                    titleTextStyle: {
                        color: 'white'
                    }
                },
                vAxis: {
                    textStyle: {
                        color: 'white'
                    },
                    titleTextStyle: {
                        color: 'white'
                    }
                },
                legend:'none',


            };
            var chart = new google.visualization.AreaChart(document.getElementById('chart_div_news'));
            chart.draw(data, options);

        }
        function drawStockChart() {
            var data = google.visualization.arrayToDataTable(stockChartData, true);
            var options = {
                legend:'none',
                backgroundColor: "transparent",
                candlestick: {
                    fallingColor: { strokeWidth: 0, fill: '#a52714' }, // red

                },



                hAxis: {
                    textStyle: {
                        color: 'white'
                    },
                    titleTextStyle: {
                        color: 'white'
                    }
                },
                vAxis: {
                    textStyle: {
                        color: 'white'
                    },
                    titleTextStyle: {
                        color: 'white'
                    },

                },
            };
            var chart = new google.visualization.CandlestickChart(document.getElementById('chart_div_stock'));
            chart.draw(data, options);
        }
    </script>
</head>
<body class="is-preload">

<!-- Wrapper -->
<div id="wrapper">

    <!-- Header -->
    <div th:replace="/fragments/nav :: navFragment"></div>

    <section id="one">
        <div class="inner">
            <divheader class="major">
                <span class="strong" th:text="${stock.name}">주식 이름 </span>
                <span class="middle" th:text="${stock.code}">주식 코드 </span>
            </divheader>
            <section>
                <div class="row">
                    <div class="col-6 col-12-small">
                        <h3 th:text="|${stock.candidate.name} 후보 테마주|">----제목</h3>
                        <p th:text="${stock.description}">회사설명.</p>
                    </div>
                </div>
              <hr/>
            </section>

            <h3 id="news_title">지난 일주일간 관련 후보 뉴스 개수</h3>

            <!--news graph-->
            <div id="chart_div_news" style="width: 100%; height: 500px;"></div>
            <div class="dateSend">
            <input type="date" id="newsStart" ><input type="date" id="newsEnd" style="margin-left:0.8em;"><button class="button primary small" id="newsCheck" style="margin-left:1em;" >확인</button>
            <div id="news_error"></div>
            </div>
            <hr/>

        </div>
    </section>

    <section id="two">
        <div class="inner">
            <h3 id="stock_title">지난 일주일간 주식 차트</h3>
            <div id="chart_div_stock" style="width: 100%; height: 500px;"></div>
            <div class="dateSend">
            <input type="date" id="stockStart" ><input type="date" id="stockEnd" style="margin-left:0.8em;"><button class="button primary small" id="stockCheck" style="margin-left:1em;">확인</button>
            <div id="stock_error"></div>
            </div>
            <hr/>
        </div>
    </section>
    <section th:if="${stock.code=='065500'}">
        <div class="inner">
            <span class="image fit">
                <img th:src="@{/images/analysis/이재명_오리엔트정공.png}">
            </span>

        </div>
    </section>

    <section id="three">
        <div class="inner">
            <div class="card mb-2">
            <div class="card-header bg-light">

            </div>
                <div class="comment">
                <div class="table-wrapper">
                    <table>
                        <thead>
                        <tr>
                            <th>Name</th>
                            <th class="th-2">comment</th>
                            <th>commented</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="co:${commentList}">
                            <td><a th:text="${co.member.email}? ${#strings.abbreviate(co.member.email,8)}:${#strings.abbreviate(co.member.kakaoEmail,8)}" th:href="@{/mypage/{id}(id=${co.member.id})}"></a></td>
                            <td th:text="${co.comment}"></td>
                            <td th:text="${#temporals.format(co.commentedAt,'MM/dd')}"></td>
                            <td><form th:action="@{{code}/delete/{id}(code=${stock.code},id=${co.id})}" method="post"><button type="submit" sec:authorize="hasRole('ADMIN')"><i class="fas fa-trash-alt"></i></button></form></td>


                        </tr>

                        </tbody>
                    </table>
                    <ul class="pagination">
                        <li><a class="button small" th:href="@{|?page=${commentList.getNumber()-1}|}"
                               th:classappend="${!commentList.hasPrevious()}?disabled">Prev</a></li>

                        <li th:each="i: ${#numbers.sequence(0,commentList.getTotalPages()-1)}" ><a th:href="@{|?page=${i}|}" class="page" th:text="${i+1}" th:classappend="${i==commentList.getNumber()}? active">1</a></li>

                        <li><a href="#" class="button small" th:href="@{|?page=${commentList.getNumber()+1}|}"
                               th:classappend="${!commentList.hasNext()}?disabled">Next</a></li></ul>

                </div>



                <div class="input-comment" sec:authorize="hasRole('USER')">
                    <i class="fa fa-comment fa"></i> comment
                    <form action="" method="post" th:object="${commentForm}">
                        <textarea class="form-control" th:field="${commentForm.comment}" rows="3"></textarea>
                        <button type="submit">post reply</button>

                    </form>
                </div>
            </div>
        </div>



        </div>
    </section>


    <!-- Footer -->
    <div th:replace="/fragments/footer :: footerFragment"></div>
</div>
<div th:replace="/fragments/script :: scriptFragment"></div>
</body>
</html>